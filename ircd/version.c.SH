#! /bin/sh

# $Id: version.c.SH,v 1.8 2007-12-11 23:38:26 zolty Exp $

echo "Extracting ircd/version.c ..."

srcdir=$1

if test -r version.c
then
   generation=`sed -n 's/^const char \*generation = \"\(.*\)\";/\1/p' < version.c`
   if test ! "$generation" ; then generation=0; fi
else
   generation=0
fi

generation=`expr $generation + 1`

creation=`date | \
awk '{if (NF == 6) \
     { print $1 " " $2 " " $3 " " $6 " at " $4 " " $5 } \
else \
     { print $1 " " $2 " " $3 " " $7 " at " $4 " " $5 " " $6 }}'`

bumpversion=`cat ../.patches`

/bin/cat >version.c <<!SUB!THIS!
/*
 * IRC-Dev IRCD - An advanced and innovative IRC Daemon, ircd/version.c
 *
 * Copyright (C) 2002-2017 IRC-Dev Development Team <devel@irc-dev.net>
 * Copyright (C) 1990 Chelsea Ashley Dyerman
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 *
 * $Id: version.c.SH,v 1.8 2007-12-11 23:38:26 zolty Exp $
 *
 */

/*
 * This file is generated by version.c.SH. Any changes made will go away.
 */

#include "version.h"
#include "patchlevel.h"
#include "patchlist.h"

const char *generation = "$generation";
const char *creation = "$creation";
const char *version = BASE_VERSION RELEASE PATCHLEVEL "$bumpversion" PATCHLIST;

const char *infotext[] = {
    "IRC --",
    "This program is free software; see LICENSE in the distribution",
    "",
    "Based on the original code written by Jarkko Oikarinen, version 2.6:",
    "Wiz          Jarkko Oikarinen         <jto@tolsun.oulu.fi>",
    "",
    "The UnderNet code is based upon version 2.8.10.",
    "The main developers of version 2.7 and 2.8 are:",
    "",
    "Avalon       Darren Reed              <avalon@coombs.anu.edu.au>",
    "msa          Markku Savela            <msa@tel4.tel.vtt.fi>",
    "Wumpus       Greg Lindahl             <lindahl@pbm.com>",
    "",
    "The main developer of version u2.9 and u2.10 was:",
    "Run          Carlo Wood               <carlo@runaway.xs4all.nl>",
    "",
    "The head developer of the u2.10 source tree was:",
    "Bleep        Thomas Helvey            <tomh@inxpress.net>",
    "",
    "The current maintainors of the u2.10 source tree are:",
    "Isomer       Perry Lorier             <perry@coders.net>",
    "Kev          Kevin Mitchell           <klmitch@mit.edu>",
    "",
    "Contributors to this release:",
    "Kev, Isomer, Gte, Ghostwolf, Bleep",
    "Debugging and support:",
    "SeKs, Maniac-, HeKTik, OmniDynmc, Liandrin, Dianora",
    "Special thanks to Angel and Buff for believing in us and putting"
    "up with frantic late night phone calls"
    "",
    "Thanks goes to all other people who contributed to any version.",
    "A full listing of all coders can be found in doc/Authors in the",
    "source.",
    "",
    "En 1999, IRC-Hispano adopta el u2.10.07 y los desarrolladores entre",
    "1999 y 2011 fueron:",
    "",
    "jcea         Jesus Cea                <jcea@jcea.es>",
    "|savage|     Jordi Murgo              <savage@apostols.org>",
    "FreeMind     Daniel Fernandez         <dfm@unr.com>",
    "zoltan       Toni Garcia              <zoltan@irc-dev.net>",
    "Amn3S1A      Miguel A. Fosas          <amn3s1a@irc-dev.net>",
    "NiKoLaS      Ruben Cardenal           <nikolas@irc-dev.net>",
    "mount        Jorge Duarte             <mount@irc-dev.net>",
    "",
    "The IRCD of IRC-Dev this based on ircu of Undernet and ircd of",
    "IRC-Hispano.",
    "Developer:",
    "zoltan       Toni Garcia               <zoltan@irc-dev.net>",
    "",
    "For more information, see http://www.irc-dev.net.",
    "",
    "Sources:",
!SUB!THIS!

( for file in ${srcdir}/ircd/*.[cly] ${srcdir}/ircd/version.c.SH ; do
    case `basename $file` in
      version.c | y.tab.c | lex.yy.c | chattr.tab.c ) ;;
      * ) echo $file ;;
    esac done ) | ./umkpasswd -5 >> version.c

echo "    \"\"," >> version.c
echo "    \"Headers:\"," >> version.c

( for file in ${srcdir}/include/*.h ; do echo $file ; done ) | ./umkpasswd -5 >> version.c

/bin/cat >>version.c <<!SUB!THIS!
    0,
};
!SUB!THIS!
